async function registrar() {
    const boton = document.querySelector("#registerBox button.btn-success");
    boton.disabled = true; // ❌ deshabilitar botón
    boton.textContent = "Registrando..."; // feedback al usuario

    const nombre = regNombre.value.trim();
    const rut = regRut.value.trim();
    const carrera = regCarrera.value;
    const telefono = regTelefono.value.trim();
    const email = regEmail.value.trim();
    const pass = regPass.value.trim();
    const mensaje = document.getElementById("mensaje");

    // Validaciones
    if(!nombre || !rut || !carrera || !telefono || !email || !pass) {
      mensaje.textContent = "⚠️ Complete todos los campos.";
      mensaje.style.color = "red"; 
      boton.disabled = false;
      boton.textContent = "Crear Cuenta";
      return;
    }

    const rutVal = validarRutCompleto(rut);
    if(!rutVal.ok){ 
      rutError.textContent = rutVal.msg; 
      boton.disabled = false;
      boton.textContent = "Crear Cuenta";
      return; 
    }

    if(!/^\+569\d{8}$/.test(telefono)){
      mensaje.textContent = "⚠️ Teléfono inválido. Use formato +569XXXXXXXX";
      mensaje.style.color = "red"; 
      boton.disabled = false;
      boton.textContent = "Crear Cuenta";
      return;
    }

    // Verificar duplicados
    const { data: existente, error: errCheck } = await supabaseClient
      .from("usuarios")
      .select("*")
      .or(`rut.eq.${rut},email.eq.${email}`);

    if (errCheck) { 
      mensaje.textContent = "❌ Error al verificar duplicados."; 
      mensaje.style.color = "red"; 
      boton.disabled = false;
      boton.textContent = "Crear Cuenta";
      return; 
    }

    if (existente.length > 0) { 
      mensaje.textContent = "⚠️ El RUT o correo ya están registrados."; 
      mensaje.style.color = "red"; 
      boton.disabled = false;
      boton.textContent = "Crear Cuenta";
      return; 
    }

    // Insertar usuario
    const { data, error } = await supabaseClient
      .from("usuarios")
      .insert([{ nombre, rut, carrera, telefono, email, pass }]);

    if (error) {
      mensaje.textContent = "❌ Error al registrar: " + error.message;
      mensaje.style.color = "red";
      boton.disabled = false;
      boton.textContent = "Crear Cuenta";
    } else {
      mensaje.textContent = "✅ Registro exitoso. Ahora puede iniciar sesión.";
      mensaje.style.color = "green";
      regNombre.value = regRut.value = regCarrera.value = regTelefono.value = regEmail.value = regPass.value = "";
      boton.disabled = false;
      boton.textContent = "Crear Cuenta";
    }
}


